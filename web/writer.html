<!DOCTYPE html>
<html>
<head>
<script src="//code.jquery.com/jquery-1.10.2.min.js" language="javascript"></script>
<script type="text/javascript" src="//crypto-js.googlecode.com/svn/tags/3.0.2/build/rollups/hmac-sha256.js"></script><script type="text/javascript" src="//crypto-js.googlecode.com/svn/tags/3.0.2/build/components/enc-base64-min.js"></script>
<script src="fs.js" language="javascript"></script>
<script src="site.js" language="javascript"></script>
</head>
<body>
<div id="message"></div>
<div id="result"></div>
<form action="postdata.php" id="writerform">
<label for="filename">Filename:</label><input type="text" name="filename" id="filename"/>
<input type="submit" name="submit" value="Save" id="savebtn"/>
<br/>
<textarea id="data" rows="50" cols="100"></textarea>
</br>
</form>
<div id="footer"></div>
<script>
function dopost(event) {
	event.preventDefault();
	var username = localStorage['username']
	var url = $("#writerform").attr("action");
	var data = $("#data").val();
	var filename = $("#filename").val();
	var signature = hash(filename, localStorage['sessionkey']);
	var result = $.post(url, {filename: filename, username: username, data: data, signature: signature});

	result.done(function(data) {
		var json = jQuery.parseJSON(data);
		$("#result").empty().append(json.message);
	});

}

$(document).ready(function() {
	if(!localStorage["username"] || !localStorage["sessionkey"]) {
		$("#message").html("<p><a href=\"logon.html\">Logon required</a></p>");
		$("#writerform").hide();
	}	
	$("#writerform").submit(function(event){dopost(event);});
	$("#footer").html(site_footer());
});


</script>
</body>
</html>
