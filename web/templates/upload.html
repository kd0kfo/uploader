{% extends "base.html" %}
{% block head %}
<script src="dropzone.min.js" language="javascript"></script>
<link rel="stylesheet" type="text/css" href="css/dropzone.css"/>
{% endblock %}
{% block content %}
<form action="upload.php" method="post" id="uploadform" class="dropzone">
<input type="hidden" id="signature" name="signature"/>
<input type="hidden" id="username" name="username"/>
</form>
<div id="message"></div>
{% endblock %}
{% block pagescript %}
$(document).ready(function() {
	var serverinfo = get_server_info();
	var filesize = 2; // MB

	if(serverinfo && serverinfo['max_upload_size']) {
		filesize = serverinfo['max_upload_size']/(1024*1024);
	}

	if(!localStorage["username"] || !localStorage["sessionkey"]) {
		$("#message").html("<p><a href=\"logon.html\">Logon required</a></p>");
		$("#uploadform").hide();
	}	
	else {
		$("#signature").val(hash("upload", localStorage['sessionkey']));
		$("#username").val(localStorage["username"]);
	}
	Dropzone.options.uploadform = {
		paramName: "file",
		maxFilesize: filesize
	};
});
{% endblock %}
